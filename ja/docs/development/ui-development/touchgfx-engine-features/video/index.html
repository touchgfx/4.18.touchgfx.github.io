<!doctype html>
<html lang="ja" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="search" type="application/opensearchdescription+xml" title="TouchGFX Documentation" href="/4.18/ja/opensearch.xml">
<script src="/js/fix-location.js"></script><title data-react-helmet="true">MJPEG Video | TouchGFX Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://support.touchgfx.com/4.18/ja/docs/development/ui-development/touchgfx-engine-features/video"><meta data-react-helmet="true" name="docsearch:language" content="ja"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="MJPEG Video | TouchGFX Documentation"><meta data-react-helmet="true" name="description" content="TouchGFX supports using MJPEG video starting from version 4.18. Video can be used to create more alive user interfaces or to show short instructions or user guides."><meta data-react-helmet="true" property="og:description" content="TouchGFX supports using MJPEG video starting from version 4.18. Video can be used to create more alive user interfaces or to show short instructions or user guides."><meta data-react-helmet="true" property="og:image" content="https://support.touchgfx.com/4.18/ja/img/meta-image.png"><meta data-react-helmet="true" name="twitter:image" content="https://support.touchgfx.com/4.18/ja/img/meta-image.png"><link data-react-helmet="true" rel="shortcut icon" href="/4.18/ja/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://support.touchgfx.com/4.18/ja/docs/development/ui-development/touchgfx-engine-features/video"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.18/docs/development/ui-development/touchgfx-engine-features/video" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.18/ko/docs/development/ui-development/touchgfx-engine-features/video" hreflang="ko"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.18/ja/docs/development/ui-development/touchgfx-engine-features/video" hreflang="ja"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.18/zh-CN/docs/development/ui-development/touchgfx-engine-features/video" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.18/zh-TW/docs/development/ui-development/touchgfx-engine-features/video" hreflang="zh-TW"><link data-react-helmet="true" rel="alternate" href="https://support.touchgfx.com/4.18/docs/development/ui-development/touchgfx-engine-features/video" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/4.18/ja/assets/css/styles.63f22108.css">
<link rel="preload" href="/4.18/ja/assets/js/runtime~main.d41f03e1.js" as="script">
<link rel="preload" href="/4.18/ja/assets/js/main.2f4acfe4.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/4.18/ja/docs/introduction/welcome"><img src="/4.18/ja/img/logo.svg" alt="TouchGFX" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/4.18/ja/img/logo.svg" alt="TouchGFX" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__item navbar__link"><span><span>日本語</span></span></a><ul class="dropdown__menu"><li><a href="/4.18/docs/development/ui-development/touchgfx-engine-features/video" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/4.18/ko/docs/development/ui-development/touchgfx-engine-features/video" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">한국어</a></li><li><a href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/video" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">日本語</a></li><li><a href="/4.18/zh-CN/docs/development/ui-development/touchgfx-engine-features/video" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">简体中文</a></li><li><a href="/4.18/zh-TW/docs/development/ui-development/touchgfx-engine-features/video" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">繁體中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/4.18/ja/docs/introduction/welcome">4.18</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/video">4.18</a></li><li><a href="https://support.touchgfx.com/4.17" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.17<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://support.touchgfx.com/4.16" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.16<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://support.touchgfx.com/4.15" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.15<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://support.touchgfx.com/4.14" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.14<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://support.touchgfx.com/4.13" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>4.13<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a href="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a><a href="https://touchgfx.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">TouchGFX.com</a><div class="searchBox_1ZXk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Basic Concepts</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Development</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/4.18/ja/docs/development/development-introduction">開発の概要</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Hardware Selection</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Board Bring Up</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">TouchGFX AL Development</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">UI Development</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/4.18/ja/docs/development/ui-development/ui-development-introduction">UI Development Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Software Architecture</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Working with TouchGFX</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Designer User Guide</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">TouchGFX Engine Features</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/custom-triggers-and-actions">Custom Triggers and Actions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/custom-containers">Custom Containers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps">Caching Bitmaps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/custom-widgets">カスタム･ウィジェット</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/canvas-widgets">Canvas Widgets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/dynamic-bitmaps">Dynamic Bitmaps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/using-binary-fonts">Binary Fonts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/font-cache">Font Caching</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/using-binary-translations">Binary Translations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/backend-communication">Backend Communication</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/mixins">Mixins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/texts-and-fonts">Texts and Fonts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/languages-and-characters">Languages and Characters</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/video">MJPEG Video</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">UI Components</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Scenarios</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Scenarios</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Miscellaneous</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorials</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Resources</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">MJPEG Video</h1></header><p>TouchGFX supports using MJPEG video starting from version 4.18. Video can be used to create more alive user interfaces or to show short instructions or user guides.</p><p>Video is included in the user interface through the new VideoWidget. This Widget is available in the TouchGFX Designer and can be added to the user interface as any other widget.</p><div class="figure"><a href="/4.18/ja/img/development/ui-development/touchgfx-engine-features/video/designer-1.png" target="_blank"><img width="60%" src="/4.18/ja/img/development/ui-development/touchgfx-engine-features/video/designer-1.png"></a><p>Using the Video Widget in TouchGFX Designer</p></div><p>Extra support software is required to decode the video on a STM32 microcontroller. This software is easily included in the project by enabling video support in the TouchGFX Generator. With a TouchGFX Board Setup where video is enabled (see list below) it is easy to run the video on the target by pressing Run Target (<code class="shortcut">F6</code>) as normal.</p><div class="figure"><a href="/4.18/ja/img/development/ui-development/touchgfx-engine-features/video/stm32f746-1.png" target="_blank"><img width="50%" src="/4.18/ja/img/development/ui-development/touchgfx-engine-features/video/stm32f746-1.png"></a><p>Using the Video Widget with STM32F746Discovery</p></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mjpeg-video"></a>MJPEG video<a class="hash-link" href="#mjpeg-video" title="Direct link to heading">#</a></h2><p>MJPEG videos consists of a large number of JPEG images (frames) packed in a container file (.avi). The JPEG frames cannot be copied directly to the framebuffer as they are compressed. The individual frames must therefore be decompressed into RGB format (16 or 24 bit) before they can be shown on the display.</p><p>This decompression is computationally expensive and lowers the performance considerably compared to using RGB bitmaps.</p><p>The advantage of the JPEG compression is the much reduced size of the data.</p><p>The video used in the above screenshots is 240 x 135 pixel. This means that each frame would take up 240 x 135 x 2 bytes = 64.800 bytes. The 7 seconds long video contains 178 frames. The total size of the video stored as bitmap would thus be 178 x 64.800 bytes = 11.534.400 bytes. The MJPEG AVI file is only 1.242.282 bytes or 10.7 % of the bitmaps.</p><p>This size reduction makes MJPEG video files very usefull for small sequences of video.</p><p>Some STM32 microcontrollers supports hardware accelerated decoding of JPEG images (e.g. STM32F769 or STM32H750). This speeds up the decoding of JPEG and increases the possible framerate of the video.</p><p>The decoding of a JPEG frame can easily take more than 16ms. This means that the decoding rate of a MJPEG video is often lower than the normal frame rate of the user interface. For some application it is acceptable to lower the overall frame rate to the decoding rate. For others it is required to keep the 60 fps frame rate of the user interface even if the video runs at e.g. 20 fps.</p><p>The above example on STM32F746 uses 18-20 ms for decoding the individual JPEG frames.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-video-with-touchgfx"></a>Using Video with TouchGFX<a class="hash-link" href="#using-video-with-touchgfx" title="Direct link to heading">#</a></h2><p>TouchGFX makes it easy to include a video as part of your user interface. You need three things: A VideoWidget, a VideoController, and of course your MJPEG video file.</p><p>The VideoWidget is used in your user interface as all other Widgets. The video controller is part of the software that makes up a full TouchGFX environment (HAL, Operating System, drivers, etc.)</p><div class="figure"><a href="/4.18/ja/img/development/ui-development/touchgfx-engine-features/video/video-sw-architecture.png" target="_blank"><img width="50%" src="/4.18/ja/img/development/ui-development/touchgfx-engine-features/video/video-sw-architecture.png"></a><p>Video Widget and Video Controller</p></div><p>The VideoController consists of software to control the decoding of the MJPEG file and buffer management.</p><p>The TouchGFX Designer automatically includes a video controller into all simulator projects. This makes it very easy to use video in simulator prototypes: Just add a VideoWidget, select a video file, and press &quot;Run Simulator&quot; (<code class="shortcut">F5</code>).</p><p>To use video on hardware you also need a video controller to be part of the project. This is already added to some of the TouchGFX Board Specification packages (see list below), but you can also easily add video support to other projects with the TouchGFX Generator. See the <a href="/4.18/ja/docs/development/touchgfx-hal-development/touchgfx-generator#video-decoding">Generator User Guide</a>.</p><p>When you have a video enabled platform it is easy to add and configure the Video Widget in the Designer. The VideoWidget is detailed <a href="/4.18/ja/docs/development/ui-development/ui-components/miscellaneous/video">here</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="video-files-in-a-touchgfx-project"></a>Video files in a TouchGFX project<a class="hash-link" href="#video-files-in-a-touchgfx-project" title="Direct link to heading">#</a></h3><p>When you include a video file in TouchGFX Designer it copies the .avi file to the <code>assets/vidoes</code> folder. During code generation the video is copied to <code>generated/videos/bin</code> as a .bin file and to <code>generated/videos/obj</code> as a .o file. The .o and .bin contains the same data, but the .o file is ELF format (which is preferred by some compilers).</p><p>The project updaters that are executed when generating code includes the video files in the target project. This means that the video files are linked into the executable and are available in the application.</p><p>The application programmer can add other videos to the <code>assets/videos</code> folder. These will also be included in the project.</p><p>The file <code>generated/videos/include/videos/VideoDatabase.hpp</code> contains symbolic information about the videos compiled into application:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">const uint32_t video_SampleVideo1_240x135_bin_length = 1242282;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#ifdef SIMULATOR</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">extern const uint8_t* video_SampleVideo1_240x135_bin_start;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#else</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">extern const uint8_t video_SampleVideo1_240x135_bin_start[];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#endif</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>These declarations can be used to assign the video to a VideoWidget in user code. The Designer does this automatically if you select the video there.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="list-of-video-enabled-development-kits"></a>List of video enabled development kits<a class="hash-link" href="#list-of-video-enabled-development-kits" title="Direct link to heading">#</a></h3><p>These development kits have video enabled by default in TouchGFX Board Setup package available in the TouchGFX Designer:</p><ul><li>STM32F769Discovery (hardware accelerated decoding)</li><li>STM32H750BDiscovery (hardware accelerated decoding)</li><li>STM32F746Discovery (software based decoding)</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="creating-mjpeg-avi-files"></a>Creating MJPEG AVI files<a class="hash-link" href="#creating-mjpeg-avi-files" title="Direct link to heading">#</a></h2><p>Most videos are not stored in MJPEG AVI files as this is not a common video format. It is therefore often necessary to convert a video file before using it in a TouchGFX project.</p><p>Conversion can easily be done with <a href="https://en.wikipedia.org/wiki/FFmpeg" target="_blank" rel="noopener noreferrer">FFMPEG</a>. Windows binaries can be found <a href="https://www.gyan.dev/ffmpeg/builds/" target="_blank" rel="noopener noreferrer">here</a>.</p><p>To convert the video file input.mov to MJPEG used this command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ffmpeg -i input.mov -s 480x272 -vcodec mjpeg -qscale 1 -an output.avi</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To keep the correct aspect ratio of the video you can specify the height as -1:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ffmpeg -i input.mov -vf scale=480:-1 -vcodec mjpeg -qscale 1 -an output.avi</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>It is possible to cut out a section of a video:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ffmpeg -ss 3 -i input.mov -t 3 -s 480x272 -vcodec mjpeg -qscale 1 -an output_section.avi</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>or:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ffmpeg -ss 3 -i input.mov -to 5 -s 480x272 -vcodec mjpeg -qscale 1 -an output_section.avi</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><table><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td>-s</td><td>Output video resolution</td></tr><tr><td>-qscale</td><td>quality scale from 1..31 (from good to bad)</td></tr><tr><td>-an</td><td>Strip audio</td></tr><tr><td>-vf</td><td>Set filter graph</td></tr><tr><td>-ss</td><td>Start time in seconds</td></tr><tr><td>-t</td><td>Duration in seconds</td></tr><tr><td>-to</td><td>Stop time in seconds</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="decoding-strategies"></a>Decoding Strategies<a class="hash-link" href="#decoding-strategies" title="Direct link to heading">#</a></h2><p>As mentioned above, TouchGFX needs to convert the individual MJPEG frames from JPEG to RGB before showing them on the framebuffer. This decoding can be done either on-the-fly when needed or asynchronous by decoding the next frame to a video buffer in advance.</p><p>The asynchronous decoding is done by second task, not the UI task. This means that the decoding can run in parallel with the UI task&#x27;s drawing (although not all the time).</p><p>TouchGFX has 3 strategies, each with advantages and disadvantages:</p><table><thead><tr><th>Strategy</th><th>Description</th></tr></thead><tbody><tr><td>Direct To Frame Buffer</td><td>Decode the current video frame directly to the framebuffer</td></tr><tr><td>Dedicated Buffer</td><td>Decode the next video frame to a video buffer. Copy from the video buffer to the frame buffer</td></tr><tr><td>Double Buffer</td><td>Decode the next video frame to a second video buffer. Swap video buffer when decoding is done</td></tr></tbody></table><p>The Designer always select the Direct To Frame Buffer strategy for simulator projects. The strategy used on target is configurable by the user in the <a href="/4.18/ja/docs/development/touchgfx-hal-development/touchgfx-generator#video-decoding">Generator</a>.</p><p>The strategies are explained in detail below.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="direct-to-frame-buffer"></a>Direct To Frame Buffer<a class="hash-link" href="#direct-to-frame-buffer" title="Direct link to heading">#</a></h3><p>The Direct To Frame Buffer strategy decodes a JPEG frame during the rendering phase on the TouchGFX engine (see <a href="/4.18/ja/docs/basic-concepts/rendering#render">Rendering</a>)</p><div class="figure"><a href="/4.18/ja/img/development/ui-development/touchgfx-engine-features/video/direct-decode.png" target="_blank"><img width="50%" src="/4.18/ja/img/development/ui-development/touchgfx-engine-features/video/direct-decode.png"></a><p>Decoding directly to the frame buffer</p></div><p>During the Update phase (see <a href="/4.18/ja/docs/basic-concepts/rendering#update">Update</a>) the Video Widget decides if the movie should be advanced to the next frame. During Rendering, the JPEG frame is decoded line-by-line to a &quot;line buffer&quot;. The pixels are then converted to match the frame buffer format and copied to the framebuffer.</p><p>This happens for all the parts of the Video Widgets that needs to be redrawn. This makes this strategy unsuitable for user interface where other UI elements like Buttons are put on top of the video.</p><p>The advantage of this solution is that only a little extra memory is used.</p><p>The decoding speed of the video affects the effective frame rate of the user interface. Assume as an example that the decoding of one JPEG frame takes 30 ms, and that we want to show 20 video frames each second (20 fps). This is realistic as the total decoding time is: 30 ms x 20/s = 600 ms/s.  The 20 fps corresponds to a new video frame in every third UI frame (of 60 fps). So in every third UI frame we want a new video frame, but as the decoding is part of the rendering phase, the rendering of that frame takes 30 ms plus the rendering of the rest of the user interface. Assuming the total rendering is 32 ms, we lost one frame. In the next frame we are not decoding video, so here the rendering is below 16 ms and meets the limit.</p><p>The result is that we cannot animate other elements of the UI with 60 fps because the video decoding limits the frame rate.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dedicated-buffer"></a>Dedicated Buffer<a class="hash-link" href="#dedicated-buffer" title="Direct link to heading">#</a></h3><p>The Dedicated or single buffer decoding strategy decodes a JPEG frame to a dedicated RGB buffer first, and then later copies that buffer to the frame buffer.</p><div class="figure"><a href="/4.18/ja/img/development/ui-development/touchgfx-engine-features/video/single-buf-decode.png" target="_blank"><img width="50%" src="/4.18/ja/img/development/ui-development/touchgfx-engine-features/video/single-buf-decode.png"></a><p>Decoding to a separate buffer</p></div><p>Opposed to the previous strategy the decoding now runs in a separate task, not the normal TouchGFX task. The Video Widget calculates if the new movie frame should be shown in the next user interface frame and signal the decoding task to start decoding the next frame. During this decoding the video buffer cannot be drawn to the frame buffer (it is partly updated). In case the user interface needs to redraw the video widget, the user interface task is blocked until the decoding has finished. If the user interface does not need to redraw the video, the user interface can continue as normal.</p><p>When the video is decoded, the cost of rendering the video to the framebuffer is the same as drawing a bitmap. With this strategy it is thus not a problem to put buttons or text on top of the video.</p><p>The disadvantage of this strategy the memory used by the task and the video buffer.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="double-buffer"></a>Double Buffer<a class="hash-link" href="#double-buffer" title="Direct link to heading">#</a></h3><p>The double buffered decoding strategy has two RGB buffers. The decoding is done into either of these buffers, whereas the rendering to the frame buffer happens from the other RGB buffer.</p><div class="figure"><a href="/4.18/ja/img/development/ui-development/touchgfx-engine-features/video/double-buf-decode.png" target="_blank"><img width="50%" src="/4.18/ja/img/development/ui-development/touchgfx-engine-features/video/double-buf-decode.png"></a><p>Decoding to two video buffers</p></div><p>The advantage of this strategy is improved frame rate. Both of the video decoding and the user interface.</p><p>The decoding of the next frame can start as soon as the user interface has changed buffer. The decoding does not have to wait until the current frame is not needed anymore by the rendering.</p><p>Similarly, the user interface does not have to wait for the decoding to finish. It can continue to render the current frame whenever needed. It is thus possible to have user interface with elements updated in every frame, even if the video decoding is only able to produce a new frame every 3 ticks.</p><p>An obvious disadvantage here is the memory usage which is doubled from the previous strategy.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/4.18/ja/docs/development/ui-development/touchgfx-engine-features/languages-and-characters"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Languages and Characters</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/4.18/ja/docs/development/ui-development/ui-components/buttons/button"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Button »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mjpeg-video" class="table-of-contents__link">MJPEG video</a></li><li><a href="#using-video-with-touchgfx" class="table-of-contents__link">Using Video with TouchGFX</a><ul><li><a href="#video-files-in-a-touchgfx-project" class="table-of-contents__link">Video files in a TouchGFX project</a></li><li><a href="#list-of-video-enabled-development-kits" class="table-of-contents__link">List of video enabled development kits</a></li></ul></li><li><a href="#creating-mjpeg-avi-files" class="table-of-contents__link">Creating MJPEG AVI files</a></li><li><a href="#decoding-strategies" class="table-of-contents__link">Decoding Strategies</a><ul><li><a href="#direct-to-frame-buffer" class="table-of-contents__link">Direct To Frame Buffer</a></li><li><a href="#dedicated-buffer" class="table-of-contents__link">Dedicated Buffer</a></li><li><a href="#double-buffer" class="table-of-contents__link">Double Buffer</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">All rights reserved © 2021 STMicroelectronics | <a href="https://www.st.com/content/st_com/en/common/terms-of-use.html">Terms of use</a> | <a href="https://www.st.com/content/st_com/en/common/privacy-policy.html">Privacy Policy</a> | <a href="/docs/miscellaneous/cookie-policy">Cookie Policy</a> | <a href="https://app-de.onetrust.com/app/#/webform/2b87200d-4023-4588-9df7-ab0cdea1a67e">Exercise your rights</a></div></div></div></footer></div>
<script src="/4.18/ja/assets/js/runtime~main.d41f03e1.js"></script>
<script src="/4.18/ja/assets/js/main.2f4acfe4.js"></script>
</body>
</html>